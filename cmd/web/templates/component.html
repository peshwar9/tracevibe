{{define "content"}}
<div class="breadcrumb">
    <a href="/">Dashboard</a>
    <span> / </span>
    <a href="/projects/{{.Project.ProjectKey}}">{{.Project.Name}}</a>
    <span> / </span>
    <span>{{.Component.Name}}</span>
</div>

{{if .Error}}
<div class="error">{{.Error}}</div>
{{end}}

<div class="stats">
    <div class="stat-card">
        <div class="stat-number">{{.ScopeCount}}</div>
        <div class="stat-label">Scope Requirements</div>
    </div>
    <div class="stat-card">
        <div class="stat-number">{{.UserStoryCount}}</div>
        <div class="stat-label">User Stories</div>
    </div>
    <div class="stat-card">
        <div class="stat-number">{{.TechSpecCount}}</div>
        <div class="stat-label">Tech Specs</div>
    </div>
    <div class="stat-card">
        <div class="stat-number">{{.TestCaseCount}}</div>
        <div class="stat-label">Test Cases</div>
    </div>
</div>

<!-- Component Info -->
<div class="card" style="margin-bottom: 2rem;">
    <div class="card-header">
        <h2 class="card-title">{{.Component.Name}}</h2>
    </div>
    <div class="card-content">
        <dl style="display: grid; grid-template-columns: 200px 1fr; gap: 1rem;">
            <dt style="font-weight: 600; color: #374151;">Component Key:</dt>
            <dd>{{.Component.ComponentKey}}</dd>

            <dt style="font-weight: 600; color: #374151;">Type:</dt>
            <dd><span class="badge badge-info">{{.Component.ComponentType}}</span></dd>

            {{if .Component.Technology}}
            <dt style="font-weight: 600; color: #374151;">Technology:</dt>
            <dd>{{.Component.Technology}}</dd>
            {{end}}

            {{if .Component.Description}}
            <dt style="font-weight: 600; color: #374151;">Description:</dt>
            <dd>{{.Component.Description}}</dd>
            {{end}}
        </dl>
    </div>
</div>

<!-- Requirements Tree -->
<div class="card">
    <div class="card-header">
        <h2 class="card-title">Requirements & Implementation</h2>
    </div>
    <div class="card-content">
        {{if .Requirements}}
        <ul class="tree">
            {{range .Requirements}}
            <li style="margin-bottom: 2rem;">
                <div class="tree-item" style="background: #f8fafc; padding: 1rem; border-radius: 6px;">
                    <span class="tree-toggle">{{if .Children}}â–¼{{else}}ðŸ“„{{end}}</span>
                    <div style="flex: 1;">
                        <div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 0.5rem;">
                            <strong style="font-size: 1.1rem;">{{.Title}}</strong>
                            <span class="badge badge-warning">SCOPE</span>
                            <span class="badge {{if eq .Status "completed"}}badge-success{{else if eq .Status "in_progress"}}badge-warning{{else}}badge-info{{end}}">
                                {{.Status}}
                            </span>
                        </div>
                        <div style="font-size: 0.875rem; color: #6b7280;">
                            {{.RequirementKey}} â€¢ {{.Category}}
                        </div>
                        {{if .Description}}
                        <div style="margin-top: 0.5rem; color: #4b5563;">{{.Description}}</div>
                        {{end}}
                    </div>
                </div>

                {{if .Children}}
                <ul class="tree">
                    {{range .Children}}
                    <li style="margin: 1rem 0;">
                        <div class="tree-item" style="background: #f1f5f9; padding: 0.75rem; border-radius: 6px;">
                            <span class="tree-toggle">{{if .Children}}â–¼{{else}}ðŸ“„{{end}}</span>
                            <div style="flex: 1;">
                                <div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 0.5rem;">
                                    <strong>{{.Title}}</strong>
                                    <span class="badge badge-info">USER STORY</span>
                                    <span class="badge {{if eq .Status "completed"}}badge-success{{else if eq .Status "in_progress"}}badge-warning{{else}}badge-info{{end}}">
                                        {{.Status}}
                                    </span>
                                </div>
                                <div style="font-size: 0.875rem; color: #6b7280;">{{.RequirementKey}}</div>
                                {{if .Description}}
                                <div style="margin-top: 0.5rem; color: #4b5563;">{{.Description}}</div>
                                {{end}}
                            </div>
                        </div>

                        {{if .Children}}
                        <ul class="tree">
                            {{range .Children}}
                            <li style="margin: 0.5rem 0;">
                                <div class="tree-item" style="border: 1px solid #e2e8f0; padding: 0.75rem; border-radius: 6px;">
                                    <span class="tree-toggle">ðŸ“‹</span>
                                    <div style="flex: 1;">
                                        <div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 0.5rem;">
                                            <strong>{{.Title}}</strong>
                                            <span class="badge badge-success">TECH SPEC</span>
                                            <span class="badge {{if eq .Status "completed"}}badge-success{{else if eq .Status "in_progress"}}badge-warning{{else}}badge-info{{end}}">
                                                {{.Status}}
                                            </span>
                                        </div>
                                        <div style="font-size: 0.875rem; color: #6b7280; margin-bottom: 0.5rem;">
                                            {{.RequirementKey}}
                                        </div>

                                        {{if .Description}}
                                        <div style="margin-bottom: 1rem; color: #4b5563; font-size: 0.875rem;">{{.Description}}</div>
                                        {{end}}

                                        <!-- Implementation Files -->
                                        {{if .Implementation}}
                                        <div style="margin-top: 1rem;">
                                            <h4 style="font-size: 0.875rem; font-weight: 600; color: #374151; margin-bottom: 0.5rem;">Implementation:</h4>
                                            {{range .Implementation}}
                                            <div style="background: #f9fafb; padding: 0.5rem; border-radius: 4px; margin-bottom: 0.5rem; font-family: monospace; font-size: 0.8rem;">
                                                <div style="color: #6366f1; font-weight: 500;">{{.Layer}}: {{.FilePath}}</div>
                                                {{if .Functions}}
                                                <div style="color: #059669; margin-top: 0.25rem;">
                                                    Functions: {{range $i, $fn := .Functions}}{{if $i}}, {{end}}{{$fn}}{{end}}
                                                </div>
                                                {{end}}
                                            </div>
                                            {{end}}
                                        </div>
                                        {{end}}

                                        <!-- Test Cases -->
                                        {{if .TestCases}}
                                        <div style="margin-top: 1rem;">
                                            <h4 style="font-size: 0.875rem; font-weight: 600; color: #374151; margin-bottom: 0.5rem;">Test Cases:</h4>
                                            {{range .TestCases}}
                                            <div style="background: #fef3c7; padding: 0.5rem; border-radius: 4px; margin-bottom: 0.25rem; font-family: monospace; font-size: 0.8rem;">
                                                <div style="color: #92400e; font-weight: 500;">{{.FilePath}}</div>
                                                <div style="color: #b45309; margin-top: 0.25rem;">{{.TestName}} ({{.TestType}})</div>
                                            </div>
                                            {{end}}
                                        </div>
                                        {{end}}
                                    </div>
                                </div>
                            </li>
                            {{end}}
                        </ul>
                        {{end}}
                    </li>
                    {{end}}
                </ul>
                {{end}}
            </li>
            {{end}}
        </ul>
        {{else}}
        <p style="color: #6b7280; text-align: center; padding: 2rem;">No requirements found for this component.</p>
        {{end}}
    </div>
</div>
{{end}}