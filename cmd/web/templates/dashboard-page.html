<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{.Title}} - TraceVibe</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background-color: #f8fafc; color: #1e293b; line-height: 1.6; }
        .header { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 1rem 0; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .header-content { max-width: 1200px; margin: 0 auto; padding: 0 1rem; display: flex; justify-content: space-between; align-items: center; }
        .logo { font-size: 1.5rem; font-weight: 700; }
        .nav { display: flex; gap: 2rem; }
        .nav a { color: white; text-decoration: none; opacity: 0.9; transition: opacity 0.2s; }
        .nav a:hover { opacity: 1; }
        .container { max-width: 1200px; margin: 2rem auto; padding: 0 1rem; }
        .card { background: white; border-radius: 8px; box-shadow: 0 1px 3px rgba(0,0,0,0.1); overflow: hidden; }
        .card-header { background: #f1f5f9; padding: 1rem 1.5rem; border-bottom: 1px solid #e2e8f0; }
        .card-title { font-size: 1.25rem; font-weight: 600; color: #1e293b; }
        .card-content { padding: 1.5rem; }
        .btn { display: inline-block; padding: 0.5rem 1rem; border-radius: 6px; text-decoration: none; font-weight: 500; transition: all 0.2s; border: none; cursor: pointer; }
        .btn-primary { background-color: #3b82f6; color: white; }
        .btn-primary:hover { background-color: #2563eb; }
        .table { width: 100%; border-collapse: collapse; }
        .table th, .table td { text-align: left; padding: 0.75rem; border-bottom: 1px solid #e2e8f0; }
        .table th { background-color: #f8fafc; font-weight: 600; color: #374151; }
        .table tbody tr:hover { background-color: #f9fafb; }
        .badge { display: inline-block; padding: 0.25rem 0.5rem; border-radius: 4px; font-size: 0.75rem; font-weight: 500; }
        .badge-success { background-color: #dcfce7; color: #166534; }
        .stats { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin-bottom: 2rem; }
        .stat-card { background: white; padding: 1.5rem; border-radius: 8px; box-shadow: 0 1px 3px rgba(0,0,0,0.1); text-align: center; }
        .stat-number { font-size: 2rem; font-weight: 700; color: #3b82f6; }
        .stat-label { color: #6b7280; font-size: 0.875rem; margin-top: 0.5rem; }
        .error { background-color: #fef2f2; border: 1px solid #fecaca; color: #dc2626; padding: 1rem; border-radius: 6px; margin-bottom: 1rem; }
    </style>
</head>
<body>
    <header class="header">
        <div class="header-content">
            <div class="logo">TraceVibe</div>
            <nav class="nav">
                <a href="/">Dashboard</a>
                <a href="/projects">Projects</a>
                <a href="/about">About</a>
            </nav>
        </div>
    </header>

    <main class="container">
        <div class="breadcrumb">
            <span>Dashboard</span>
        </div>

        {{if .Error}}
        <div class="error">{{.Error}}</div>
        {{end}}

        {{if .Projects}}
        <div class="stats">
            <div class="stat-card">
                <div class="stat-number">{{len .Projects}}</div>
                <div class="stat-label">Total Projects</div>
            </div>
            <div class="stat-card">
                <div class="stat-number">{{.TotalComponents}}</div>
                <div class="stat-label">System Components</div>
            </div>
            <div class="stat-card">
                <div class="stat-number">{{.TotalRequirements}}</div>
                <div class="stat-label">Requirements</div>
            </div>
            <div class="stat-card">
                <div class="stat-number">{{.TotalTestCases}}</div>
                <div class="stat-label">Test Cases</div>
            </div>
        </div>

        <div class="card">
            <div class="card-header" style="display: flex; justify-content: space-between; align-items: center;">
                <h2 class="card-title">Projects</h2>
                <div style="display: flex; gap: 0.5rem;">
                    <button onclick="showMethodologyModal()" class="btn" style="background-color: #059669; color: white; border: 1px solid #047857;" title="Configure TraceVibe Code Generation Methodology">üèóÔ∏è Methodology</button>
                    <button onclick="showImportModal()" class="btn btn-primary" style="background-color: #3b82f6; border: 1px solid #2563eb;">üì§ Import Project</button>
                    <button onclick="showCreateProjectModal()" class="btn btn-primary">+ Create Project</button>
                </div>
            </div>
            <div class="card-content">
                <table class="table">
                    <thead>
                        <tr>
                            <th>Project</th>
                            <th>Components</th>
                            <th>Scopes</th>
                            <th>User Stories</th>
                            <th>Tech Specs</th>
                            <th>Unit Tests</th>
                            <th>Integration Tests</th>
                            <th>E2E Tests</th>
                            <th>Status</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        {{range .Projects}}
                        <tr>
                            <td>
                                <div>
                                    <strong>{{.Name}}</strong>
                                    <div style="font-size: 0.875rem; color: #6b7280;">{{.ProjectKey}}</div>
                                </div>
                            </td>
                            <td>{{.ComponentCount}}</td>
                            <td>{{.ScopeCount}}</td>
                            <td>{{.UserStoryCount}}</td>
                            <td>{{.TechSpecCount}}</td>
                            <td>{{.UnitTestCount}}</td>
                            <td>{{.IntegrationTestCount}}</td>
                            <td>{{.E2ETestCount}}</td>
                            <td>
                                <span class="badge badge-success">{{.Status}}</span>
                            </td>
                            <td>
                                <a href="/projects/{{.ProjectKey}}" class="btn btn-primary" style="margin-right: 0.5rem;">View Details</a>
                                <!-- Export Dropdown -->
                                <div style="position: relative; display: inline-block; margin-right: 0.5rem;">
                                    <button onclick="toggleProjectExportDropdown('{{.ProjectKey}}')" class="btn" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 0.5rem 1rem; border-radius: 6px; border: none; cursor: pointer; display: flex; align-items: center; gap: 0.25rem;">
                                        üì§ Export
                                        <span style="font-size: 0.75rem;">‚ñº</span>
                                    </button>
                                    <div id="exportDropdown-{{.ProjectKey}}" style="display: none; position: absolute; right: 0; top: 100%; background: white; min-width: 180px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); border-radius: 6px; border: 1px solid #e5e7eb; z-index: 1000; margin-top: 0.25rem;">
                                        <div style="padding: 0.5rem 0;">
                                            <a href="/export/{{.ProjectKey}}" style="display: block; padding: 0.5rem 1rem; color: #374151; text-decoration: none; font-size: 0.875rem;" onmouseover="this.style.backgroundColor='#f9fafb'" onmouseout="this.style.backgroundColor='white'">üìÑ HTML Report</a>
                                            <a href="/export-json/{{.ProjectKey}}" style="display: block; padding: 0.5rem 1rem; color: #374151; text-decoration: none; font-size: 0.875rem;" onmouseover="this.style.backgroundColor='#f9fafb'" onmouseout="this.style.backgroundColor='white'">ü§ñ JSON (LLM)</a>
                                            <a href="/export-yaml/{{.ProjectKey}}" style="display: block; padding: 0.5rem 1rem; color: #374151; text-decoration: none; font-size: 0.875rem;" onmouseover="this.style.backgroundColor='#f9fafb'" onmouseout="this.style.backgroundColor='white'">üìã YAML (LLM)</a>
                                            <a href="/export-markdown/{{.ProjectKey}}" style="display: block; padding: 0.5rem 1rem; color: #374151; text-decoration: none; font-size: 0.875rem;" onmouseover="this.style.backgroundColor='#f9fafb'" onmouseout="this.style.backgroundColor='white'">üìù Markdown</a>
                                        </div>
                                    </div>
                                </div>
                                <button onclick="deleteProject('{{.ProjectKey}}')" class="btn" style="background-color: #ef4444; color: white; padding: 0.5rem 1rem; border-radius: 6px; border: none; cursor: pointer;">Delete</button>
                            </td>
                        </tr>
                        {{end}}
                    </tbody>
                </table>
            </div>
        </div>
        {{else}}
        <div class="card">
            <div class="card-content" style="text-align: center; padding: 3rem;">
                <h2 style="color: #6b7280; margin-bottom: 1rem;">No Projects Found</h2>
                <p style="color: #9ca3af; margin-bottom: 2rem;">
                    Import your first RTM project to get started.
                </p>

                <!-- Action buttons for empty state -->
                <div style="display: flex; gap: 1rem; justify-content: center; margin-bottom: 2rem;">
                    <button onclick="showImportModal()" class="btn btn-primary" style="background-color: #059669; border: 1px solid #059669;">üì§ Import Project</button>
                    <button onclick="showCreateProjectModal()" class="btn btn-primary">+ Create Project</button>
                </div>

                <!-- Info icon with tooltip -->
                <div style="display: flex; justify-content: center; margin-top: 1rem;">
                    <button onclick="showUsageInfoModal()" style="background: none; border: none; cursor: pointer; color: #6b7280; font-size: 1.5rem; padding: 0.5rem; border-radius: 50%; transition: background-color 0.2s;" onmouseover="this.style.backgroundColor='#f3f4f6'" onmouseout="this.style.backgroundColor='transparent'" title="How to use TraceVibe">
                        ‚ÑπÔ∏è
                    </button>
                </div>
            </div>
        </div>
        {{end}}
    </main>

    <!-- Create Project Modal -->
    <div id="createProjectModal" class="modal" style="display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.5);">
        <div class="modal-content" style="background-color: white; margin: 5% auto; padding: 20px; border-radius: 8px; max-width: 600px; width: 90%;">
            <div class="modal-header" style="border-bottom: 1px solid #e5e7eb; padding-bottom: 1rem; margin-bottom: 1.5rem;">
                <h2 style="margin: 0; color: #1e293b;">Create New Project</h2>
            </div>
            <div class="modal-body">
                <div class="form-group" style="margin-bottom: 1rem;">
                    <label class="form-label" style="display: block; margin-bottom: 0.5rem; font-weight: 500; color: #374151;">Project Name *</label>
                    <input type="text" id="projectName" class="form-control" placeholder="Enter project name" style="width: 100%; padding: 0.5rem; border: 1px solid #d1d5db; border-radius: 4px;">
                </div>
                <div class="form-group" style="margin-bottom: 1rem;">
                    <label class="form-label" style="display: block; margin-bottom: 0.5rem; font-weight: 500; color: #374151;">Project Key *</label>
                    <input type="text" id="projectKey" class="form-control" placeholder="e.g., my-project" style="width: 100%; padding: 0.5rem; border: 1px solid #d1d5db; border-radius: 4px;">
                    <small style="color: #6b7280; font-size: 0.875rem;">Used in URLs. Use lowercase letters, numbers, and hyphens only.</small>
                </div>
                <div class="form-group" style="margin-bottom: 1rem;">
                    <label class="form-label" style="display: block; margin-bottom: 0.5rem; font-weight: 500; color: #374151;">Description</label>
                    <textarea id="projectDescription" class="form-control" placeholder="Enter project description" style="width: 100%; padding: 0.5rem; border: 1px solid #d1d5db; border-radius: 4px; min-height: 100px; resize: vertical;"></textarea>
                </div>
                <div class="form-group" style="margin-bottom: 1rem;">
                    <label class="form-label" style="display: block; margin-bottom: 0.5rem; font-weight: 500; color: #374151;">Repository URL</label>
                    <input type="url" id="projectRepository" class="form-control" placeholder="https://github.com/user/repo" style="width: 100%; padding: 0.5rem; border: 1px solid #d1d5db; border-radius: 4px;">
                </div>
                <div class="form-group" style="margin-bottom: 1rem;">
                    <label class="form-label" style="display: block; margin-bottom: 0.5rem; font-weight: 500; color: #374151;">Version</label>
                    <input type="text" id="projectVersion" class="form-control" placeholder="1.0.0" style="width: 100%; padding: 0.5rem; border: 1px solid #d1d5db; border-radius: 4px;">
                </div>
            </div>
            <div class="modal-footer" style="border-top: 1px solid #e5e7eb; padding-top: 1rem; display: flex; justify-content: flex-end; gap: 0.5rem;">
                <button onclick="closeCreateProjectModal()" style="padding: 0.5rem 1rem; border: 1px solid #d1d5db; background: white; border-radius: 4px; cursor: pointer;">Cancel</button>
                <button onclick="createProject()" style="padding: 0.5rem 1rem; background-color: #3b82f6; color: white; border: none; border-radius: 4px; cursor: pointer;">Create Project</button>
            </div>
        </div>
    </div>

    <!-- Import Modal -->
    <div id="importModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000; justify-content: center; align-items: center;">
        <div style="background: white; border-radius: 8px; padding: 2rem; max-width: 500px; width: 90%; max-height: 90vh; overflow-y: auto;">
            <h2 style="margin-bottom: 1.5rem; color: #1e293b;">Import Project</h2>
            <form id="importForm" enctype="multipart/form-data">
                <div style="margin-bottom: 1rem;">
                    <label style="display: block; margin-bottom: 0.5rem; font-weight: 600; color: #374151;">Project Key *</label>
                    <input type="text" name="project_key" placeholder="e.g., my-project, statsly" style="width: 100%; padding: 0.75rem; border: 1px solid #d1d5db; border-radius: 6px; font-size: 1rem;" required>
                    <small style="color: #6b7280; font-size: 0.875rem;">Unique identifier for your project</small>
                </div>
                <div style="margin-bottom: 1rem;">
                    <label style="display: block; margin-bottom: 0.5rem; font-weight: 600; color: #374151;">RTM File *</label>
                    <input type="file" name="file" accept=".yaml,.yml,.json" style="width: 100%; padding: 0.75rem; border: 1px solid #d1d5db; border-radius: 6px; font-size: 1rem;" required>
                    <small style="color: #6b7280; font-size: 0.875rem;">Select YAML or JSON file containing your project data</small>
                </div>
                <div style="margin-bottom: 1.5rem;">
                    <label style="display: flex; align-items: center; gap: 0.5rem; font-weight: 600; color: #374151;">
                        <input type="checkbox" name="overwrite" value="true" style="margin: 0;">
                        Overwrite existing project data
                    </label>
                    <small style="color: #6b7280; font-size: 0.875rem; margin-left: 1.5rem;">If unchecked, will update existing data and add new items</small>
                </div>
                <div style="display: flex; gap: 1rem; justify-content: flex-end;">
                    <button type="button" onclick="closeImportModal()" style="padding: 0.75rem 1.5rem; border: 1px solid #d1d5db; background: white; color: #374151; border-radius: 6px; cursor: pointer; font-size: 1rem;">Cancel</button>
                    <button type="button" onclick="importProject()" class="btn-primary" style="padding: 0.75rem 1.5rem; background: #3b82f6; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 1rem;">Import Project</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Methodology Modal -->
    <div id="methodologyModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000; justify-content: center; align-items: center;">
        <div style="background: white; border-radius: 8px; padding: 2rem; max-width: 800px; width: 90%; max-height: 90vh; overflow-y: auto;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem; border-bottom: 1px solid #e5e7eb; padding-bottom: 1rem;">
                <h2 style="margin: 0; color: #059669;">üèóÔ∏è TraceVibe Code Generation Methodology</h2>
                <button onclick="closeMethodologyModal()" style="background: none; border: none; font-size: 1.5rem; cursor: pointer; color: #6b7280; padding: 0.25rem;">&times;</button>
            </div>

            <p style="color: #6b7280; font-size: 0.875rem; margin-bottom: 1rem;">Configure how LLMs should approach code generation using TraceVibe RTM structure</p>

            <div style="margin-bottom: 1rem;">
                <label style="display: block; margin-bottom: 0.5rem; font-weight: 600; color: #374151;">Methodology Instructions</label>
                <textarea id="methodologyText" style="width: 100%; min-height: 400px; padding: 0.75rem; border: 1px solid #d1d5db; border-radius: 6px; font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace; font-size: 0.875rem; line-height: 1.5;"></textarea>
            </div>

            <div style="margin-bottom: 1rem;">
                <button onclick="loadDefaultMethodology()" style="padding: 0.5rem 1rem; background-color: #f59e0b; color: white; border: none; border-radius: 6px; cursor: pointer;">üîÑ Load Default Template</button>
            </div>

            <div style="padding: 1rem; background: #f0f9ff; border-radius: 6px; border-left: 4px solid #0ea5e9; margin-bottom: 1.5rem;">
                <p style="margin: 0; font-size: 0.875rem; color: #0c4a6e;">
                    <strong>üí° Note:</strong> This methodology context will be included in all Code Gen prompts to guide the LLM on TraceVibe's component-based approach, code organization, and testing strategies.
                </p>
            </div>

            <div style="display: flex; gap: 1rem; justify-content: flex-end;">
                <button onclick="closeMethodologyModal()" style="padding: 0.75rem 1.5rem; border: 1px solid #d1d5db; background: white; color: #374151; border-radius: 6px; cursor: pointer; font-size: 1rem;">Cancel</button>
                <button onclick="saveMethodology()" style="padding: 0.75rem 1.5rem; background: #059669; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 1rem;">üíæ Save Methodology</button>
            </div>
        </div>
    </div>

    <!-- Usage Info Modal -->
    <div id="usageInfoModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000; justify-content: center; align-items: center;">
        <div style="background: white; border-radius: 8px; padding: 2rem; max-width: 700px; width: 90%; max-height: 90vh; overflow-y: auto;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem; border-bottom: 1px solid #e5e7eb; padding-bottom: 1rem;">
                <h2 style="margin: 0; color: #1e293b;">How to Use TraceVibe</h2>
                <button onclick="closeUsageInfoModal()" style="background: none; border: none; font-size: 1.5rem; cursor: pointer; color: #6b7280; padding: 0.25rem;">&times;</button>
            </div>

            <div style="color: #374151; line-height: 1.6;">
                <p style="margin-bottom: 1.5rem; color: #6b7280;">TraceVibe helps you create and manage Requirements Traceability Matrix (RTM) for projects with AI-generated code. There are three ways to get started:</p>

                <div style="margin-bottom: 2rem;">
                    <h3 style="color: #059669; margin-bottom: 0.5rem; display: flex; align-items: center; gap: 0.5rem;">
                        <span style="background: #059669; color: white; border-radius: 50%; width: 24px; height: 24px; display: flex; align-items: center; justify-content: center; font-size: 0.875rem; font-weight: bold;">1</span>
                        Create a New Project from Scratch
                    </h3>
                    <p style="margin-left: 2rem; color: #6b7280;">Start with a blank project and manually add components, requirements, and test cases through the UI.</p>
                </div>

                <div style="margin-bottom: 2rem;">
                    <h3 style="color: #3b82f6; margin-bottom: 0.5rem; display: flex; align-items: center; gap: 0.5rem;">
                        <span style="background: #3b82f6; color: white; border-radius: 50%; width: 24px; height: 24px; display: flex; align-items: center; justify-content: center; font-size: 0.875rem; font-weight: bold;">2</span>
                        Import an Existing Project
                    </h3>
                    <p style="margin-left: 2rem; color: #6b7280;">Import a project that was previously exported from TraceVibe (YAML or JSON format).</p>
                </div>

                <div style="margin-bottom: 1rem;">
                    <h3 style="color: #8b5cf6; margin-bottom: 0.5rem; display: flex; align-items: center; gap: 0.5rem;">
                        <span style="background: #8b5cf6; color: white; border-radius: 50%; width: 24px; height: 24px; display: flex; align-items: center; justify-content: center; font-size: 0.875rem; font-weight: bold;">3</span>
                        Reverse Engineer Existing Codebase
                    </h3>
                    <div style="margin-left: 2rem;">
                        <p style="color: #6b7280; margin-bottom: 1rem;">For existing codebases, use AI to generate RTM documentation:</p>
                        <ol style="color: #6b7280; line-height: 1.8; padding-left: 1.5rem;">
                            <li>Generate guidelines: <code style="background: #f3f4f6; padding: 0.25rem 0.5rem; border-radius: 4px; font-family: monospace;">tracevibe guidelines</code></li>
                            <li>Use the generated <code style="background: #f3f4f6; padding: 0.25rem 0.5rem; border-radius: 4px; font-family: monospace;">rtm-guidelines.md</code> and prompt with any LLM</li>
                            <li>Provide the LLM with your repository link and the guidelines</li>
                            <li>Ask the LLM to analyze your code and generate TraceVibe-compatible YAML/JSON</li>
                            <li>Import the generated file using the Import button above</li>
                        </ol>
                    </div>
                </div>
            </div>

            <div style="display: flex; justify-content: center; margin-top: 2rem; padding-top: 1rem; border-top: 1px solid #e5e7eb;">
                <button onclick="closeUsageInfoModal()" class="btn btn-primary">Got it!</button>
            </div>
        </div>
    </div>

    <script>
        // TraceVibe Methodology Management
        function showMethodologyModal() {
            const modal = document.getElementById('methodologyModal');
            modal.style.display = 'flex';

            const savedMethodology = localStorage.getItem('tracevibeMethodology') || '';
            if (!savedMethodology) {
                loadDefaultMethodology();
            } else {
                document.getElementById('methodologyText').value = savedMethodology;
            }
        }

        function closeMethodologyModal() {
            document.getElementById('methodologyModal').style.display = 'none';
        }

        function saveMethodology() {
            const methodologyText = document.getElementById('methodologyText').value;
            localStorage.setItem('tracevibeMethodology', methodologyText);

            // Show success feedback
            const saveButton = document.querySelector('#methodologyModal button[onclick="saveMethodology()"]');
            const originalText = saveButton.innerHTML;
            saveButton.innerHTML = '‚úÖ Saved!';
            saveButton.style.backgroundColor = '#10b981';

            setTimeout(() => {
                saveButton.innerHTML = originalText;
                saveButton.style.backgroundColor = '#059669';
                closeMethodologyModal();
            }, 1500);
        }

        function loadDefaultMethodology() {
            const defaultMethodology = `# TraceVibe Code Generation Methodology

## Overview
TraceVibe follows a component-based architecture where each component is an independently deployable unit with its own source code, tests, build configuration, and deployment setup.

## Code Organization Structure

### Component-Based Architecture
\`\`\`
project-root/
‚îú‚îÄ‚îÄ components/
‚îÇ   ‚îú‚îÄ‚îÄ component-1/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ src/                 # Source code
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ tests/               # Unit & integration tests
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ config/              # Component-specific config
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ build/               # Build scripts & artifacts
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ deploy/              # Deployment configurations
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ docs/                # Component documentation
‚îÇ   ‚îú‚îÄ‚îÄ component-2/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ [same structure]
‚îÇ   ‚îî‚îÄ‚îÄ shared/                  # Shared utilities & libraries
‚îú‚îÄ‚îÄ docs/                        # Project-level documentation
‚îú‚îÄ‚îÄ scripts/                     # Build & deployment orchestration
‚îî‚îÄ‚îÄ infrastructure/              # Infrastructure as code
\`\`\`

## Implementation Guidelines

### 1. Component Independence
- Each component should be independently:
  - **Testable**: Complete test suite in component/tests/
  - **Buildable**: Build scripts in component/build/
  - **Deployable**: Deployment config in component/deploy/
  - **Configurable**: Environment-specific config in component/config/

### 2. Code Generation Approach
When implementing requirements:

**Component Level**:
- Generate complete component structure
- Include all architectural layers (API, business logic, data access)
- Create comprehensive test suite
- Add build and deployment configurations

**Scope Level**:
- Implement functional scope across relevant components
- Ensure cross-component integration
- Create integration tests
- Document scope-level architecture decisions

**Story Level**:
- Implement user journey end-to-end
- Include frontend, backend, and data layers as needed
- Create user acceptance tests
- Document user story completion criteria

**Tech Spec Level**:
- Focus on specific technical implementation
- Include detailed unit tests
- Document technical decisions and trade-offs
- Ensure integration with related specs

### 3. Testing Strategy
- **Unit Tests**: In component/tests/unit/
- **Integration Tests**: In component/tests/integration/
- **End-to-End Tests**: In component/tests/e2e/
- **Contract Tests**: For API boundaries between components

### 4. Documentation Standards
- **README.md**: Component overview and quick start
- **API.md**: API documentation for components with interfaces
- **ARCHITECTURE.md**: Component architecture decisions
- **TESTING.md**: How to run and maintain tests

### 5. RTM Integration
- Add RTM reference comments in code: \`/* RTM: [SPEC_ID] */\`
- Map requirements to implementation files
- Maintain traceability from code back to requirements
- Update RTM when implementation deviates from specs

## Deployment Considerations
- Each component can be deployed independently
- Use container-based deployment when possible
- Include health checks and monitoring
- Implement circuit breakers for component communication
- Plan for graceful degradation when components are unavailable

## Quality Gates
Before considering implementation complete:
1. ‚úÖ All RTM requirements mapped to code
2. ‚úÖ Test coverage meets project standards
3. ‚úÖ Component can be built independently
4. ‚úÖ Component can be deployed independently
5. ‚úÖ Documentation is complete and up-to-date
6. ‚úÖ Security review completed (if applicable)
7. ‚úÖ Performance benchmarks meet requirements

This methodology ensures that code generated from TraceVibe RTM follows consistent, maintainable, and scalable patterns.`;

            document.getElementById('methodologyText').value = defaultMethodology;
        }

        // Project creation functions
        function showCreateProjectModal() {
            document.getElementById('createProjectModal').style.display = 'block';
        }

        function closeCreateProjectModal() {
            document.getElementById('createProjectModal').style.display = 'none';
            // Clear form fields
            document.getElementById('projectName').value = '';
            document.getElementById('projectKey').value = '';
            document.getElementById('projectDescription').value = '';
            document.getElementById('projectRepository').value = '';
            document.getElementById('projectVersion').value = '';
        }

        // Auto-generate project key from project name
        document.getElementById('projectName').addEventListener('input', function(e) {
            const name = e.target.value;
            const key = name.toLowerCase()
                .replace(/[^a-z0-9\s-]/g, '')
                .replace(/\s+/g, '-')
                .replace(/-+/g, '-')
                .replace(/^-|-$/g, '');
            document.getElementById('projectKey').value = key;
        });

        async function createProject() {
            const name = document.getElementById('projectName').value.trim();
            const projectKey = document.getElementById('projectKey').value.trim();
            const description = document.getElementById('projectDescription').value.trim();
            const repositoryURL = document.getElementById('projectRepository').value.trim();
            const version = document.getElementById('projectVersion').value.trim();

            // Validate required fields
            if (!name) {
                alert('Please enter a project name');
                return;
            }

            if (!projectKey) {
                alert('Please enter a project key');
                return;
            }

            // Validate project key format
            if (!/^[a-z0-9-]+$/.test(projectKey)) {
                alert('Project key must contain only lowercase letters, numbers, and hyphens');
                return;
            }

            try {
                const response = await fetch('/api/projects/create', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        name,
                        project_key: projectKey,
                        description: description || undefined,
                        repository_url: repositoryURL || undefined,
                        version: version || undefined
                    })
                });

                if (response.ok) {
                    const result = await response.json();
                    closeCreateProjectModal();
                    alert('Project created successfully!');
                    window.location.reload();
                } else {
                    const error = await response.text();
                    alert('Failed to create project: ' + error);
                }
            } catch (error) {
                console.error('Error creating project:', error);
                alert('Error creating project: ' + error.message);
            }
        }

        // Export dropdown functionality for dashboard
        function toggleProjectExportDropdown(projectKey) {
            console.log('Toggling export dropdown for project:', projectKey);
            const dropdown = document.getElementById('exportDropdown-' + projectKey);
            const isVisible = dropdown.style.display !== 'none';

            // Close all other dropdowns first
            document.querySelectorAll('[id^="exportDropdown-"]').forEach(d => {
                if (d !== dropdown) {
                    d.style.display = 'none';
                }
            });

            if (isVisible) {
                dropdown.style.display = 'none';
            } else {
                dropdown.style.display = 'block';
            }
        }

        // Close modal and dropdowns when clicking outside
        window.onclick = function(event) {
            const modal = document.getElementById('createProjectModal');
            if (event.target === modal) {
                closeCreateProjectModal();
            }

            // Close export dropdowns if clicking outside
            if (!event.target.closest('button')) {
                document.querySelectorAll('[id^="exportDropdown-"]').forEach(dropdown => {
                    dropdown.style.display = 'none';
                });
            }
        }

        async function deleteProject(projectKey) {
            if (!confirm(`Are you sure you want to delete project '${projectKey}'? This action cannot be undone.`)) {
                return;
            }

            try {
                const response = await fetch(`/api/project/${projectKey}/delete`, {
                    method: 'DELETE'
                });

                if (response.ok) {
                    alert(`Project '${projectKey}' has been deleted successfully.`);
                    window.location.reload();
                } else {
                    const error = await response.text();
                    alert(`Failed to delete project: ${error}`);
                }
            } catch (error) {
                alert(`Error: ${error.message}`);
            }
        }

        // Import functionality
        function showImportModal() {
            document.getElementById('importModal').style.display = 'flex';
        }

        function closeImportModal() {
            document.getElementById('importModal').style.display = 'none';
            document.getElementById('importForm').reset();
        }

        function importProject() {
            const form = document.getElementById('importForm');
            const formData = new FormData(form);

            const projectKey = formData.get('project_key');
            const file = formData.get('file');

            if (!projectKey.trim()) {
                alert('Please enter a project key');
                return;
            }

            if (!file || file.size === 0) {
                alert('Please select a file to import');
                return;
            }

            // Show loading state
            const submitBtn = document.querySelector('#importModal .btn-primary');
            const originalText = submitBtn.textContent;
            submitBtn.textContent = 'Importing...';
            submitBtn.disabled = true;

            fetch('/api/import', {
                method: 'POST',
                body: formData
            })
            .then(response => response.json())
            .then(result => {
                if (result.success) {
                    alert(`Successfully imported ${result.filename} for project: ${result.project_key}`);
                    closeImportModal();
                    // Reload page to show imported project
                    window.location.reload();
                } else {
                    alert('Import failed: ' + (result.error || 'Unknown error'));
                }
            })
            .catch(error => {
                console.error('Import error:', error);
                alert('Import failed. Please try again.');
            })
            .finally(() => {
                // Restore button state
                submitBtn.textContent = originalText;
                submitBtn.disabled = false;
            });
        }

        // Close import modal when clicking outside
        document.addEventListener('click', function(e) {
            const importModal = document.getElementById('importModal');
            if (e.target === importModal) {
                closeImportModal();
            }
        });

        // Usage info modal functions
        function showUsageInfoModal() {
            document.getElementById('usageInfoModal').style.display = 'flex';
        }

        function closeUsageInfoModal() {
            document.getElementById('usageInfoModal').style.display = 'none';
        }

        // Close usage info modal when clicking outside
        document.addEventListener('click', function(e) {
            const usageInfoModal = document.getElementById('usageInfoModal');
            if (e.target === usageInfoModal) {
                closeUsageInfoModal();
            }
        });
    </script>
</body>
</html>